<!--
   ____     U  ___ u __  __        _   _           ____     _   _    ____     _   _     
U | __")u    \/"_ \/ \ \/"/       | \ |"|       U | __")uU |"|u| |U |  _"\ u | \ |"|    
 \|  _ \/    | | | | /\  /\      <|  \| |>       \|  _ \/ \| |\| | \| |_) |/<|  \| |>   
  | |_) |.-,_| |_| |U /  \ u     U| |\  |u        | |_) |  | |_| |  |  _ <  U| |\  |u   
  |____/  \_)-\___/  /_/\_\       |_| \_|         |____/  <<\___/   |_| \_\  |_| \_|    
 _|| \\_       \\  ,-,>> \\_      ||   \\,-.     _|| \\_ (__) )(    //   \\_ ||   \\,-. 
(__) (__)     (__)  \_)  (__)     (_")  (_/     (__) (__)    (__)  (__)  (__)(_")  (_/  
-->

<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Box N Burn | Login</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      display:flex;justify-content:center;align-items:center;
      min-height:100vh;
      background:url('https://i.ibb.co/5XkVnKjY/Boxing-Spinning-Yoga.png') no-repeat center/cover;
      position:relative;
    }
    body::before {
      content:"";position:absolute;inset:0;
      background:rgba(0,0,0,0.5);backdrop-filter:blur(12px);
    }
    .login-card {
      position:relative;z-index:1;
      width:95%;max-width:420px;
      padding:30px;
      background:rgba(255,255,255,0.1);
      border-radius:18px;
      box-shadow:0 8px 30px rgba(0,0,0,0.4);
      backdrop-filter:blur(18px);
      text-align:center;
      color:#fff;
      animation:fadeIn 0.7s ease-out;
    }
    .login-card img {
      width:100px;height:100px;
      border-radius:50%;border:3px solid #fff;
      object-fit:cover;margin-bottom:15px;
      display:none;
    }
    .login-card h2 {margin-bottom:20px;font-size:22px;}

    .input-group {position:relative;margin-bottom:20px;}
    .input-group input {
      width:100%;padding:14px 45px 14px 14px;
      border-radius:10px;border:none;
      font-size:15px;
      background:rgba(255,255,255,0.9);
      outline:none;color:#000;
      transition:0.3s;
    }
    .input-group label {
      position:absolute;left:14px;top:50%;
      transform:translateY(-50%);
      font-size:15px;color:#555;
      transition:0.2s;
      pointer-events:none;
    }
    .input-group input:focus + label,
    .input-group input:not(:placeholder-shown) + label {
      top:-8px;font-size:12px;color:#0078d7;
      background:#fff;padding:0 5px;border-radius:3px;
    }
    .toggle-eye {
      position:absolute;right:14px;top:50%;
      transform:translateY(-50%);
      cursor:pointer;font-size:18px;color:#555;
    }

    button {
      width:100%;padding:14px;
      border:none;border-radius:10px;
      background:#0078d7;color:#fff;
      font-size:16px;font-weight:600;
      cursor:pointer;transition:0.3s;
    }
    button:disabled {background:#555;cursor:not-allowed;}
    button:hover:not(:disabled) {background:#005a9e;}

    .remember-me {display:flex;align-items:center;gap:8px;margin-bottom:15px;}
    .remember-me input {accent-color:#0078d7;}

    #error {
      display:none;color:#ff4d4d;
      margin-top:10px;font-size:14px;
      animation:shake 0.4s;
    }

    .loading-spinner {
      width:22px;height:22px;
      border:3px solid rgba(255,255,255,0.3);
      border-top:3px solid #fff;
      border-radius:50%;
      margin:0 auto 15px;
      animation:spin 0.8s linear infinite;
      display:none;
    }

    .dark-toggle {
      position:absolute;top:15px;right:15px;
      background:rgba(255,255,255,0.2);
      border:none;padding:8px 12px;
      border-radius:50%;cursor:pointer;
      color:#fff;font-size:18px;
      transition:0.3s;
    }
    .dark-mode body::before {background:rgba(0,0,0,0.8);}

    @keyframes fadeIn {from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    @keyframes spin {100%{transform:rotate(360deg);}}
    @keyframes shake {0%,100%{transform:translateX(0);}25%{transform:translateX(-6px);}75%{transform:translateX(6px);}}
  </style>
</head>
<body>
  <button class="dark-toggle" onclick="toggleDarkMode()"><i class='bx bx-moon'></i></button>
  <div class="login-card">
    <img id="pfp" src="">
    <h2 id="welcomeText">Aanmelden</h2>

    <div class="input-group">
      <input type="text" id="username" placeholder=" " autocomplete="off">
      <label for="username">Gebruikersnaam</label>
    </div>
    <div class="input-group" id="passwordGroup" style="display:none;">
      <input type="password" id="password" placeholder=" ">
      <label for="password">Wachtwoord</label>
      <i class='bx bx-hide toggle-eye' onclick="togglePassword()"></i>
    </div>

    <div class="remember-me" style="display:none;" id="rememberMe">
      <input type="checkbox" id="remember"> <label for="remember">Onthoud mij</label>
    </div>

    <div class="loading-spinner" id="spinner"></div>
    <button id="loginBtn" style="display:none;" onclick="login()">Aanmelden</button>
    <p id="error">‚ùå Ongeldige gebruikersnaam of wachtwoord!</p>
  </div>

<script>
  const USER_SHEET_ID = "13VmSUVWPTmlHNN8QREDodih8AKb56114FLQg5-1wyjo";
  const API_KEY = "AIzaSyDCIoC-dzEh-ptJVTEfhLH7FgrUWYcqKL4";
  let users = {};

  async function fetchUsers() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${USER_SHEET_ID}/values/Users!A2:E?key=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    if (!data.values) return;
    users = {};
    data.values.forEach(row => {
      const [username, password, role, bio, pfp] = row;
      users[username] = { password, role, bio, pfp };
    });
  }

  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const passwordGroup = document.getElementById("passwordGroup");
  const loginBtn = document.getElementById("loginBtn");
  const pfp = document.getElementById("pfp");
  const welcomeText = document.getElementById("welcomeText");
  const error = document.getElementById("error");
  const rememberMe = document.getElementById("rememberMe");
  const spinner = document.getElementById("spinner");

  usernameInput.addEventListener("input", () => {
    const name = usernameInput.value.trim();
    if (users[name]) {
      pfp.src = users[name].pfp;
      pfp.style.display = "block";
      welcomeText.textContent = `Welkom, ${name}`;
      passwordGroup.style.display = "block";
      loginBtn.style.display = "block";
      rememberMe.style.display = "flex";
    } else {
      pfp.style.display = "none";
      welcomeText.textContent = "Aanmelden";
      passwordGroup.style.display = "none";
      loginBtn.style.display = "none";
      rememberMe.style.display = "none";
    }
  });

  function login() {
    const user = usernameInput.value.trim();
    const pass = passwordInput.value.trim();
    if (users[user] && users[user].password === pass) {
      spinner.style.display = "block";
      loginBtn.disabled = true;
      localStorage.setItem("loggedInUser", user);
      localStorage.setItem("userRole", users[user].role);
      localStorage.setItem("userBio", users[user].bio);
      localStorage.setItem("userPfp", users[user].pfp);

      setTimeout(() => {
        const role = users[user].role.toLowerCase();
        if (role.includes("admin")) window.location.href = "/dashboard/admin";
        else if (role.includes("trainer")) window.location.href = "/dashboard/trainer";
        else window.location.href = "/dashboard/member";
      }, 2000);
    } else {
      error.style.display = "block";
      setTimeout(() => error.style.display = "none", 3000);
    }
  }

  function togglePassword() {
    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      document.querySelector(".toggle-eye").classList.replace("bx-hide", "bx-show");
    } else {
      passwordInput.type = "password";
      document.querySelector(".toggle-eye").classList.replace("bx-show", "bx-hide");
    }
  }

  function toggleDarkMode(){
    document.body.classList.toggle("dark-mode");
  }

  document.addEventListener("keydown", e => {
    if (e.key === "Enter" && usernameInput.value && passwordInput.value) login();
  });

  fetchUsers();
</script>
</body>
</html>
