<!--
   ____     U  ___ u __  __        _   _           ____     _   _    ____     _   _     
U | __")u    \/"_ \/ \ \/"/       | \ |"|       U | __")uU |"|u| |U |  _"\ u | \ |"|    
 \|  _ \/    | | | | /\  /\      <|  \| |>       \|  _ \/ \| |\| | \| |_) |/<|  \| |>   
  | |_) |.-,_| |_| |U /  \ u     U| |\  |u        | |_) |  | |_| |  |  _ <  U| |\  |u   
  |____/  \_)-\___/  /_/\_\       |_| \_|         |____/  <<\___/   |_| \_\  |_| \_|    
 _|| \\_       \\  ,-,>> \\_      ||   \\,-.     _|| \\_ (__) )(    //   \\_ ||   \\,-. 
(__) (__)     (__)  \_)  (__)     (_")  (_/     (__) (__)    (__)  (__)  (__)(_")  (_/  
-->

<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Box N Burn — Login</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <style>
    :root{
      --accent:#0078d7;
      --accent-hover:#005a9e;
      --bg-dark:rgba(0,0,0,0.55);
      --glass:rgba(255,255,255,0.08);
      --white:#fff;
      --danger:#ff4d4d;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',Roboto,Arial,sans-serif;
      display:flex;justify-content:center;align-items:center;
      min-height:100vh;
      background:url('https://i.ibb.co/5XkVnKjY/Boxing-Spinning-Yoga.png') center/cover fixed;
      position:relative;
    }
    body::before{content:'';position:absolute;inset:0;background:var(--bg-dark);backdrop-filter:blur(8px)}

    .container{
      position:relative;z-index:1;
      display:flex;flex-direction:column;align-items:center;
      padding:40px 28px;
      width:90%;max-width:420px;
      background:var(--glass);
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.15);
      box-shadow:0 8px 30px rgba(0,0,0,0.5);
      color:var(--white);
      text-align:center;
    }

    .logo{width:90px;height:90px;border-radius:50%;margin-bottom:18px;object-fit:cover;border:3px solid var(--white)}
    h1{font-size:22px;margin-bottom:20px}

    .input-group{position:relative;width:100%;margin-bottom:16px}
    .input-group input{
      width:100%;padding:14px;border-radius:10px;border:none;font-size:15px;
      outline:none;background:rgba(255,255,255,0.9);color:#000;
    }
    .input-group label{
      position:absolute;left:14px;top:50%;transform:translateY(-50%);
      color:#666;font-size:14px;pointer-events:none;transition:0.2s;
    }
    .input-group input:focus+label,
    .input-group input:not(:placeholder-shown)+label{
      top:-8px;left:10px;font-size:12px;background:#fff;padding:0 4px;border-radius:3px;color:var(--accent);
    }
    .toggle-eye{position:absolute;right:14px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:18px;color:#555}

    .btn{
      width:100%;padding:14px;margin-top:8px;
      background:var(--accent);color:#fff;font-weight:700;border:none;border-radius:10px;
      cursor:pointer;transition:background .2s;
    }
    .btn:hover{background:var(--accent-hover)}
    .btn:disabled{opacity:0.6;cursor:not-allowed}

    .link-btn{margin-top:10px;font-size:14px;color:var(--white);cursor:pointer;text-decoration:underline;}
    .link-btn:hover{color:#ccc}

    .error{color:var(--danger);display:none;margin-top:10px;font-size:14px}

    .profile{display:none;flex-direction:column;align-items:center;margin-bottom:18px}
    .profile img{width:70px;height:70px;border-radius:50%;object-fit:cover;border:2px solid var(--white)}
    .profile h3{margin-top:10px;font-size:16px}
    .profile p{font-size:13px;opacity:0.85}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.65);display:none;align-items:center;justify-content:center;z-index:99}
    .overlay .box{background:var(--glass);padding:20px;border-radius:12px;text-align:center;color:#fff}
    .spinner{width:30px;height:30px;border:4px solid rgba(255,255,255,0.4);border-top:4px solid #fff;border-radius:50%;margin:0 auto 12px;animation:spin 1s linear infinite}

    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="container">
    <img src="https://i.ibb.co/1q3Qm9g/boxnburn.png" alt="logo" class="logo">
    <h1>Box N Burn — Aanmelden</h1>

    <div class="profile" id="profile">
      <img id="pfp" src="">
      <h3 id="welcomeName"></h3>
      <p id="welcomeBio"></p>
    </div>

    <div class="input-group">
      <input type="text" id="username" placeholder=" ">
      <label for="username">Gebruikersnaam</label>
    </div>
    <div class="input-group" id="passwordGroup" style="display:none">
      <input type="password" id="password" placeholder=" ">
      <label for="password">Wachtwoord</label>
      <i class='bx bx-low-vision toggle-eye' id="eye"></i>
    </div>

    <button class="btn" id="loginBtn" style="display:none">Aanmelden</button>
    <div class="link-btn" id="logoutBtn" style="display:none">Uitloggen</div>

    <div class="error" id="error">❌ Ongeldige gebruikersnaam of wachtwoord</div>
  </div>

  <div class="overlay" id="overlay">
    <div class="box">
      <div class="spinner"></div>
      <div id="overlayText">Even geduld...</div>
    </div>
  </div>

<script>
const USER_SHEET_ID = "13VmSUVWPTmlHNN8QREDodih8AKb56114FLQg5-1wyjo";
const API_KEY = "AIzaSyDCIoC-dzEh-ptJVTEfhLH7FgrUWYcqKL4";
let users={};

const usernameInput=document.getElementById('username');
const passwordInput=document.getElementById('password');
const passwordGroup=document.getElementById('passwordGroup');
const loginBtn=document.getElementById('loginBtn');
const logoutBtn=document.getElementById('logoutBtn');
const profile=document.getElementById('profile');
const pfp=document.getElementById('pfp');
const welcomeName=document.getElementById('welcomeName');
const welcomeBio=document.getElementById('welcomeBio');
const errorBox=document.getElementById('error');
const overlay=document.getElementById('overlay');
const overlayText=document.getElementById('overlayText');
const eye=document.getElementById('eye');

async function fetchUsers(){
  const url=`https://sheets.googleapis.com/v4/spreadsheets/${USER_SHEET_ID}/values/Users!A2:E?key=${API_KEY}`;
  const res=await fetch(url);
  const data=await res.json();
  if(!data.values)return;
  users={};
  data.values.forEach(row=>{
    const [username,password,role,bio,pfpUrl]=row;
    users[username]={password,role,bio,pfp:pfpUrl};
  });
}

function showOverlay(text){overlayText.textContent=text;overlay.style.display='flex'}
function hideOverlay(){overlay.style.display='none'}

usernameInput.addEventListener('input',()=>{
  const u=usernameInput.value.trim();
  if(users[u]){
    profile.style.display='flex';
    pfp.src=users[u].pfp;
    welcomeName.textContent=`Welkom ${u}`;
    welcomeBio.textContent=users[u].bio||'';
    passwordGroup.style.display='block';
    loginBtn.style.display='block';
  } else {
    profile.style.display='none';
    passwordGroup.style.display='none';
    loginBtn.style.display='none';
  }
});

loginBtn.addEventListener('click',()=>{
  const u=usernameInput.value.trim();
  const p=passwordInput.value.trim();
  if(users[u]&&users[u].password===p){
    localStorage.setItem('loggedInUser',u);
    localStorage.setItem('userRole',users[u].role);
    localStorage.setItem('userBio',users[u].bio);
    localStorage.setItem('userPfp',users[u].pfp);
    showOverlay('Succesvol ingelogd...');
    setTimeout(()=>{
      hideOverlay();
      window.location.href=`/dashboard/${users[u].role.toLowerCase()}`;
    },2000);
  } else {
    errorBox.style.display='block';
    setTimeout(()=>errorBox.style.display='none',3000);
  }
});

logoutBtn.addEventListener('click',()=>{
  localStorage.clear();
  location.reload();
});

ey.addEventListener('click',()=>{
  if(passwordInput.type==='password'){
    passwordInput.type='text';
    eye.classList.replace('bx-low-vision','bx-show');
  } else {
    passwordInput.type='password';
    eye.classList.replace('bx-show','bx-low-vision');
  }
});

document.addEventListener('keydown',e=>{if(e.key==='Enter'&&loginBtn.style.display==='block')loginBtn.click()});

window.addEventListener('DOMContentLoaded',async()=>{
  await fetchUsers();
  const u=localStorage.getItem('loggedInUser');
  if(u&&users[u]){
    profile.style.display='flex';
    pfp.src=users[u].pfp;
    welcomeName.textContent=`Welkom ${u}`;
    welcomeBio.textContent=users[u].bio||'';
    passwordGroup.style.display='none';
    loginBtn.style.display='none';
    logoutBtn.style.display='block';
  }
});
</script>
</body>
</html>

