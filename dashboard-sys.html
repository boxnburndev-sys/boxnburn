<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Box N Burn — Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg1:#03061a;
  --bg2:#071428;
  --panel:#0b1620;
  --glass:rgba(255,255,255,0.03);
  --muted:#9fb0bf;
  --accent:#1fb6ff;
  --good:#2dd36f;
  --warn:#ffb020;
  --bad:#ff5c7c;
  --neon:#9d4dff;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#eaf6ff;-webkit-font-smoothing:antialiased}
.navbar{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;background:linear-gradient(90deg,rgba(255,255,255,0.01),rgba(255,255,255,0.01));backdrop-filter:blur(6px)}
.brand{font-weight:800;color:var(--accent);font-size:1.25rem;letter-spacing:0.6px}
.controls{display:flex;gap:12px;align-items:center}
.clock{color:var(--accent);font-weight:700}
.btn{background:linear-gradient(90deg,var(--accent),var(--neon));border:none;padding:8px 12px;border-radius:10px;color:#001822;cursor:pointer;font-weight:700;box-shadow:0 6px 20px rgba(0,0,0,0.6)}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04)}
.layout{display:grid;grid-template-columns:320px 1fr 420px;gap:18px;padding:18px}
.left{display:flex;flex-direction:column;gap:18px}
.card{background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
.h2{font-size:1rem;color:var(--muted);margin:0 0 8px 0}
.stat{font-size:1.6rem;font-weight:800;color:var(--accent);margin-top:6px}
.server-list{display:flex;flex-direction:column;gap:8px}
.server{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
.server .meta{display:flex;flex-direction:column}
.server .name{font-weight:700}
.server .sub{font-size:0.85rem;color:var(--muted)}
.badge{padding:6px 8px;border-radius:8px;font-weight:700}
.up{background:linear-gradient(90deg,#2dd36f,#1fbf6f);color:#02120b}
.down{background:linear-gradient(90deg,#ff5c7c,#ff7b9a);color:#2a0610}
.center{display:flex;align-items:center;justify-content:center}
.middle{display:flex;flex-direction:column;gap:18px}
.top-row{display:flex;gap:18px}
.panel-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
.canvas-wrap{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:10px;border-radius:10px}
.table{width:100%;border-collapse:collapse;font-size:0.9rem}
.table th,.table td{padding:8px;text-align:left;color:#dff3ff}
.terminal{background:linear-gradient(180deg,rgba(255,255,255,0.015),transparent);height:460px;border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px}
.output{flex:1;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:13px;color:#dff3ff;padding-right:6px}
.input{display:flex;gap:8px}
.cmd{flex:1;background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:#e8fbff;font-family:ui-monospace,monospace}
.suggestion{font-size:12px;color:var(--muted)}
.incidents{height:220px;overflow:auto}
.pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700;color:var(--muted)}
.kv{display:flex;justify-content:space-between;gap:8px}
.gadget{display:flex;flex-direction:column;gap:8px}
.smallchart{height:120px}
.footer{display:flex;justify-content:space-between;align-items:center;padding:10px 18px;color:var(--muted);font-size:0.85rem}
.debug-log{height:120px;overflow:auto;background:rgba(255,255,255,0.01);padding:8px;border-radius:8px;font-family:monospace}
.switch{display:inline-flex;align-items:center;gap:6px}
.toggle{width:44px;height:26px;border-radius:999px;background:rgba(255,255,255,0.03);position:relative;cursor:pointer}
.knob{position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#00121a;transition:all .18s}
.toggle.on{background:linear-gradient(90deg,#2dd36f,#1fbf6f)}
.toggle.on .knob{left:21px;background:#041416}
.legend{display:flex;gap:8px;flex-wrap:wrap}
.seed{font-family:ui-monospace,monospace;color:#9fb0bf;font-size:12px}
.ascii{font-family:ui-monospace,monospace;color:var(--accent);white-space:pre-wrap}
.badge-mini{padding:4px 6px;border-radius:6px;background:rgba(255,255,255,0.02);font-weight:700;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<nav class="navbar">
  <div class="brand">Box N Burn Command Center</div>
  <div class="controls">
    <div class="clock" id="clock">--:--:--</div>
    <div class="pill" id="statusPill">SIM MODE</div>
  </div>
</nav>

<div class="layout">
  <div class="left">
    <div class="card">
      <div class="h2">Operators</div>
      <div class="server-list" id="opsList">
        <div class="server"><div class="meta"><div class="name">Operator-Alpha</div><div class="sub">Shift: Morning</div></div><div class="badge-mini up">Online</div></div>
        <div class="server"><div class="meta"><div class="name">Operator-Beta</div><div class="sub">Shift: Night</div></div><div class="badge-mini up">Online</div></div>
      </div>
    </div>

    <div class="card gadget">
      <div class="h2">Quick Controls</div>
      <div class="kv"><div class="pill">Auto-Resolve</div><div class="switch"><div class="toggle" id="autoResolveToggle"><div class="knob"></div></div></div></div>
      <div class="kv"><div class="pill">Sound Alerts</div><div class="switch"><div class="toggle on" id="soundToggle"><div class="knob"></div></div></div></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="clearIncidents">Clear Incidents</button>
        <button class="btn ghost" id="downloadLog">Download Log</button>
      </div>
    </div>

    <div class="card">
      <div class="h2">Network Snapshot</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px">
        <div class="card canvas-wrap smallchart"><canvas id="nwChart"></canvas></div>
        <div class="card canvas-wrap smallchart"><canvas id="connChart"></canvas></div>
        <div class="card canvas-wrap smallchart"><canvas id="latChart"></canvas></div>
        <div class="card canvas-wrap smallchart"><canvas id="errChart"></canvas></div>
      </div>
    </div>
  </div>

  <div class="middle">
    <div class="top-row">
      <div class="card" style="flex:1">
        <div class="h2">Overview</div>
        <div style="display:flex;gap:12px;margin-top:8px">
          <div style="flex:1">
            <div class="stat">Servers: <span id="serverCount">5</span></div>
            <div class="legend" style="margin-top:8px">
              <div class="badge-mini">CPU <span id="cpuAvg">15%</span></div>
              <div class="badge-mini">RAM <span id="ramAvg">30%</span></div>
              <div class="badge-mini">NET <span id="netAvg">20%</span></div>
            </div>
          </div>
          <div style="width:260px">
            <div class="canvas-wrap" style="padding:8px">
              <canvas id="sysSpark"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="width:320px">
        <div class="h2">Active Services</div>
        <div id="serviceTableWrap" style="margin-top:8px">
          <table class="table" id="serviceTable">
            <thead><tr><th>Service</th><th>Status</th><th>Latency</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="panel-grid">
      <div class="card">
        <div class="h2">CPU Usage</div>
        <div class="canvas-wrap"><canvas id="cpuChart" style="height:180px"></canvas></div>
      </div>
      <div class="card">
        <div class="h2">RAM Usage</div>
        <div class="canvas-wrap"><canvas id="ramChart" style="height:180px"></canvas></div>
      </div>
      <div class="card">
        <div class="h2">Disk IO</div>
        <div class="canvas-wrap"><canvas id="diskChart" style="height:180px"></canvas></div>
      </div>
    </div>

    <div class="card">
      <div class="h2">Threat Radar & Events</div>
      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <canvas id="threatChart" style="height:160px"></canvas>
        </div>
        <div style="width:320px" class="incidents" id="incidents"></div>
      </div>
    </div>
  </div>

  <div class="right">
    <div class="card terminal" id="terminalCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="h2">Command Console</div>
        <div class="suggestion">Type <span class="pill">help</span> for commands</div>
      </div>
      <div class="output" id="output"></div>
      <div class="input">
        <input class="cmd" id="cmdInput" placeholder="Enter command...">
        <button class="btn ghost" id="runBtn">RUN</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
        <div class="seed" id="sessionSeed">Session: SIM-1001</div>
        <div style="flex:1"></div>
        <div class="badge-mini">v1.0-sim</div>
      </div>
    </div>

    <div class="card">
      <div class="h2">Tools & Gadgets</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <div style="display:flex;gap:8px">
          <button class="btn" id="portScanBtn">Port Scan</button>
          <button class="btn ghost" id="pcapBtn">Start PCAP</button>
          <button class="btn ghost" id="tailBtn">Tail Logs</button>
        </div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <button class="btn" id="deployBtn">Sim Deploy</button>
          <button class="btn ghost" id="stressBtn">Stress Test</button>
          <button class="btn ghost" id="auditBtn">Run Audit</button>
        </div>
        <div class="debug-log" id="toolLog"></div>
      </div>
    </div>

    <div class="card">
      <div class="h2">Recent Debug</div>
      <div class="debug-log" id="debugLog"></div>
    </div>
  </div>
</div>

<div class="footer">
  <div>Box N Burn — Simulated dashboard</div>
  <div class="seed" id="uptimeSeed">Uptime: 99.99%</div>
</div>

<script>
let SEQ = 1001
const clockEl = document.getElementById('clock')
setInterval(()=>{const d=new Date();clockEl.textContent=d.toLocaleTimeString()},1000)
const serverList = [
  {id:'srv-web-01',name:'Web Server 01',cpu:14,ram:28,disk:34,up:true,ips:['10.0.1.3']},
  {id:'srv-db-01',name:'DB Server 01',cpu:16,ram:30,disk:40,up:true,ips:['10.0.1.5']},
  {id:'srv-bkp-01',name:'Backup Node',cpu:8,ram:22,disk:10,up:true,ips:['10.0.2.3']},
  {id:'srv-proxy-01',name:'Proxy',cpu:12,ram:20,disk:18,up:true,ips:['10.0.0.9']},
  {id:'srv-ai-01',name:'Inference Node',cpu:9,ram:26,disk:22,up:true,ips:['10.0.3.7']}
]
const services = [
  {name:'website.com',svc:'HTTP',status:true,lat:24},
  {name:'api.website.com',svc:'API',status:true,lat:38},
  {name:'intranet.local',svc:'INTRANET',status:true,lat:7},
  {name:'mail.website.com',svc:'SMTP',status:true,lat:180}
]
const incidents = []
const output = document.getElementById('output')
const cmdInput = document.getElementById('cmdInput')
const runBtn = document.getElementById('runBtn')
const incidentsEl = document.getElementById('incidents')
const serviceTableBody = document.querySelector('#serviceTable tbody')
const debugLog = document.getElementById('debugLog')
const toolLog = document.getElementById('toolLog')
const autoResolveToggle = document.getElementById('autoResolveToggle')
let autoResolve = false
autoResolveToggle.addEventListener('click', ()=>{autoResolve = !autoResolve;autoResolveToggle.classList.toggle('on', autoResolve);appendTool(autoResolve?'Auto-resolve enabled':'Auto-resolve disabled')})
const soundToggle = document.getElementById('soundToggle')
let soundEnabled = true
soundToggle.addEventListener('click', ()=>{soundEnabled = !soundEnabled;soundToggle.classList.toggle('on', soundEnabled)})
document.getElementById('portScanBtn').addEventListener('click', ()=>{simulatePortScan('192.168.1.12')})
document.getElementById('pcapBtn').addEventListener('click', ()=>{togglePcap()})
document.getElementById('tailBtn').addEventListener('click', ()=>{tailLogs()})
document.getElementById('deployBtn').addEventListener('click', ()=>{simulateDeploy()})
document.getElementById('stressBtn').addEventListener('click', ()=>{simulateStress()})
document.getElementById('auditBtn').addEventListener('click', ()=>{runAudit()})
runBtn.addEventListener('click', ()=>{const v=cmdInput.value;execute(v);cmdInput.value='';cmdInput.focus()})
cmdInput.addEventListener('keydown', (e)=>{if(e.key==='Enter'){runBtn.click()}})

function rnd(min,max){return Math.floor(Math.random()*(max-min+1))+min}
function appendOut(txt,color){
  const d=document.createElement('div');d.className='terminal-line';d.innerHTML=`<span class="terminal-prompt">$</span> <span style="color:${color||'#dff3ff'}">${txt}</span>`;output.appendChild(d);output.scrollTop=output.scrollHeight
}
function appendTool(txt){const d=document.createElement('div');d.textContent=new Date().toLocaleTimeString()+' - '+txt;toolLog.prepend(d);if(toolLog.children.length>200) toolLog.removeChild(toolLog.lastChild)}
function appendDebug(txt){const d=document.createElement('div');d.textContent=new Date().toLocaleTimeString()+' - '+txt;debugLog.prepend(d);if(debugLog.children.length>200) debugLog.removeChild(debugLog.lastChild)}

function downloadLog(){
  let txt = ''
  const rows = [...debugLog.children]
  rows.reverse().forEach(r=>{txt += r.textContent + '\n'})
  const blob = new Blob([txt],{type:'text/plain'})
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a');a.href=url;a.download='debug-log.txt';a.click();URL.revokeObjectURL(url)
}

function renderServices(){
  serviceTableBody.innerHTML=''
  services.forEach(s=>{
    const tr=document.createElement('tr')
    tr.innerHTML=`<td>${s.name} <span class="badge-mini">${s.svc}</span></td><td>${s.status?'<span class="up badge">UP</span>':'<span class="down badge">DOWN</span>'}</td><td>${s.lat}ms</td>`
    serviceTableBody.appendChild(tr)
  })
}

function renderIncidents(){
  incidentsEl.innerHTML=''
  incidents.slice(0,50).forEach((inc,i)=>{
    const div=document.createElement('div')
    div.style.padding='8px';div.style.marginBottom='8px';div.style.borderRadius='8px'
    div.style.background=i%2? 'rgba(255,255,255,0.01)': 'rgba(255,255,255,0.02)'
    div.innerHTML=`<div style="display:flex;justify-content:space-between"><div style="font-weight:800">${inc.title}</div><div style="font-size:12px;color:var(--muted)">${inc.level}</div></div><div style="font-size:12px;color:var(--muted);margin-top:6px">${inc.msg}</div><div style="font-size:12px;color:var(--muted);margin-top:6px">${new Date(inc.ts).toLocaleString()}</div>`
    incidentsEl.appendChild(div)
  })
}

function pushIncident(title,msg,level='HIGH'){
  incidents.unshift({title,msg,level,ts:Date.now()})
  renderIncidents()
  appendDebug('Incident: '+title)
  if(soundEnabled) playBeep()
  if(autoResolve) setTimeout(()=>{resolveOldest()},6000)
}

function resolveOldest(){
  if(incidents.length===0) return
  const inc = incidents.shift()
  renderIncidents()
  appendTool('Auto-resolved incident: '+inc.title)
}

function spawnIncident(){
  const titles = ['Service Unreachable','High CPU Spike','DB Connection Errors','Failed Backup','Suspicious Login','Certificate Expiry']
  const msgs = ['Endpoint returned 5xx responses from multiple regions','CPU crossed 95% on node','Connection pool exhausted by worker processes','Last snapshot failed at midnight','Multiple failed logins from 3rd party IP','TLS cert expires in 2 days']
  const i = rnd(0,titles.length-1)
  pushIncident(titles[i],msgs[i], rnd(0,1)?'CRITICAL':'HIGH')
}

function spawnPanic(){
  for(let i=0;i<5;i++){ setTimeout(()=>{spawnIncident()}, i*300) }
  appendTool('PANIC sequence triggered')
}

function appendSeeded(){
  const el = document.getElementById('sessionSeed')
  el.textContent = 'Session: SIM-'+SEQ
}
appendSeeded()

function playBeep(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)()
    const o = ctx.createOscillator()
    const g = ctx.createGain()
    o.type='sine';o.frequency.value=600
    o.connect(g);g.connect(ctx.destination);g.gain.value=0.02
    o.start();setTimeout(()=>{o.stop();ctx.close()},140)
  }catch(e){}
}

function simulateMetricsOnce(){
  let cpuSum=0,ramSum=0,netSum=0
  serverList.forEach(s=>{
    s.cpu = Math.max(2,Math.min(99,Math.round((s.cpu*0.7) + rnd(0,30))))
    s.ram = Math.max(10,Math.min(99,Math.round((s.ram*0.75) + rnd(0,25))))
    s.disk = Math.max(5,Math.min(99,Math.round((s.disk*0.9)+ rnd(0,12))))
    if(Math.random()>0.999) s.up = !s.up
    cpuSum += s.cpu; ramSum += s.ram; netSum += s.disk
  })
  document.getElementById('serverCount').textContent = serverList.length
  document.getElementById('cpuAvg').textContent = Math.round(cpuSum/serverList.length) + '%'
  document.getElementById('ramAvg').textContent = Math.round(ramSum/serverList.length) + '%'
  document.getElementById('netAvg').textContent = Math.round(netSum/serverList.length) + '%'
  renderServices()
  updateChartsOnce()
}

const cpuCtx = document.getElementById('cpuChart').getContext('2d')
const ramCtx = document.getElementById('ramChart').getContext('2d')
const diskCtx = document.getElementById('diskChart').getContext('2d')
const threatCtx = document.getElementById('threatChart').getContext('2d')
const sysSparkCtx = document.getElementById('sysSpark').getContext('2d')
const nwCtx = document.getElementById('nwChart').getContext('2d')
const connCtx = document.getElementById('connChart').getContext('2d')
const latCtx = document.getElementById('latChart').getContext('2d')
const errCtx = document.getElementById('errChart').getContext('2d')

const cpuChart = new Chart(cpuCtx, {type:'line',data:{labels:[],datasets:[{label:'CPU %',data:[],borderColor: 'rgba(31,182,255,1)',backgroundColor:'rgba(31,182,255,0.08)',tension:0.3}]},options:{plugins:{legend:{display:false}},scales:{y:{min:0,max:100}}}})
const ramChart = new Chart(ramCtx, {type:'line',data:{labels:[],datasets:[{label:'RAM %',data:[],borderColor: 'rgba(45,211,111,1)',backgroundColor:'rgba(45,211,111,0.06)',tension:0.3}]},options:{plugins:{legend:{display:false}},scales:{y:{min:0,max:100}}}})
const diskChart = new Chart(diskCtx, {type:'line',data:{labels:[],datasets:[{label:'Disk IO',data:[],borderColor: 'rgba(255,92,124,1)',backgroundColor:'rgba(255,92,124,0.06)',tension:0.3}]},options:{plugins:{legend:{display:false}},scales:{y:{min:0,max:100}}}})
const threatChart = new Chart(threatCtx, {type:'radar',data:{labels:['Malware','Phishing','DDoS','Exploit','Botnet','Ransomware'],datasets:[{label:'Threat Index',data:[5,3,2,4,1,2],backgroundColor:'rgba(255,176,32,0.18)',borderColor:'#ffb020'}]},options:{scales:{r:{min:0,max:100}}}})
const sysSpark = new Chart(sysSparkCtx,{type:'line',data:{labels:[],datasets:[{label:'Sys',data:[],borderColor:'#9d4dff',tension:0.4}]},options:{plugins:{legend:{display:false}},scales:{y:{display:false},x:{display:false}}}})
const nwChart = new Chart(nwCtx,{type:'doughnut',data:{labels:['LAN','WAN','CLOUD'],datasets:[{data:[30,40,30],backgroundColor:['#1fb6ff','#2dd36f','#ffb020']}]}})
const connChart = new Chart(connCtx,{type:'bar',data:{labels:['US','EU','APAC'],datasets:[{data:[120,100,140],backgroundColor:'#1fb6ff'}]}})
const latChart = new Chart(latCtx,{type:'line',data:{labels:[],datasets:[{data:[],borderColor:'#ffb020',tension:0.3}]}})
const errChart = new Chart(errCtx,{type:'line',data:{labels:[],datasets:[{data:[],borderColor:'#ff5c7c',tension:0.3}]}})

function pushToChart(chart,label,value){
  chart.data.labels.push(label)
  chart.data.datasets[0].data.push(value)
  if(chart.data.labels.length>24){chart.data.labels.shift();chart.data.datasets[0].data.shift()}
  chart.update()
}

function updateChartsOnce(){
  const t = new Date().toLocaleTimeString()
  const cpuAvg = Math.round(serverList.reduce((s,x)=>s+x.cpu,0)/serverList.length)
  const ramAvg = Math.round(serverList.reduce((s,x)=>s+x.ram,0)/serverList.length)
  const diskAvg = Math.round(serverList.reduce((s,x)=>s+x.disk,0)/serverList.length)
  pushToChart(cpuChart,t,cpuAvg)
  pushToChart(ramChart,t,ramAvg)
  pushToChart(diskChart,t,diskAvg)
  pushToChart(sysSpark,t, Math.round((cpuAvg+ramAvg+diskAvg)/3))
  pushToChart(latChart,t, rnd(10,240))
  pushToChart(errChart,t, rnd(0,10))
  const threats = Array.from({length:6},()=>rnd(0,100))
  threatChart.data.datasets[0].data = threats
  threatChart.update()
}

function randomLogLine(){
  const verbs = ['INFO','WARN','ERROR','DEBUG','TRACE']
  const comps = ['auth','db','worker','scheduler','cache','proxy','backup']
  const msgs = ['operation completed','connection reset','timeout after 120s','cache miss','permission denied','job queued','received heartbeat']
  return `${new Date().toISOString()} ${verbs[rnd(0,verbs.length-1)]} ${comps[rnd(0,comps.length-1)]}: ${msgs[rnd(0,msgs.length-1)]}`
}

const tailers = {}
function tailLogs(){
  const id = 'tail-'+Date.now()
  appendTool('Starting tail session '+id)
  tailers[id] = setInterval(()=>{appendOut(randomLogLine());appendDebug('tail:'+randomLogLine())},500)
  setTimeout(()=>{clearInterval(tailers[id]);delete tailers[id];appendTool('Tail ended '+id)},15000)
}

let pcapOn = false
function togglePcap(){
  pcapOn = !pcapOn
  appendTool((pcapOn?'PCAP started':'PCAP stopped'))
  if(pcapOn){
    let c=0
    const pid = setInterval(()=>{appendDebug(`pcap: packet ${++c} src=192.168.${rnd(0,5)}.${rnd(2,254)} dst=10.0.${rnd(0,5)}.${rnd(2,254)} proto=${['TCP','UDP','ICMP'][rnd(0,2)]}`)},300)
    setTimeout(()=>{clearInterval(pid);pcapOn=false;appendTool('PCAP auto-stopped after 12s')},12000)
  }
}

function simulateDeploy(){
  appendOut('> deploy start')
  appendOut('pushing artifacts...')
  setTimeout(()=>{appendOut('starting rollout...')},800)
  setTimeout(()=>{appendOut('verifying health endpoints...')},1600)
  setTimeout(()=>{appendOut('canary ok, rolling full...')},2800)
  setTimeout(()=>{appendOut('deploy complete: SUCCESS')},4200)
  appendTool('Simulated deploy completed')
}

function simulateStress(){
  appendOut('> stress --target srv-web-01 --time 30s')
  let i=0
  const id = setInterval(()=>{i++; appendOut(`stress: iteration ${i} - requests ${rnd(800,1200)} latency ${rnd(120,800)}ms`); appendDebug('stress:'+i)},600)
  setTimeout(()=>{clearInterval(id);appendOut('stress complete');appendTool('Stress test finished')},8000)
}

function runAudit(){
  appendOut('> run-audit')
  appendOut('scanning configurations...')
  setTimeout(()=>{appendOut('found 3 low-risk issues');appendOut('recommended: rotate keys, update dependencies')},1200)
  appendTool('Audit generated summary')
}

function simulatePortScan(target='127.0.0.1'){
  appendOut(`> portscan ${target}`)
  const ports = [22,80,443,8080,3306,5432,6379,27017]
  let i=0
  const id = setInterval(()=>{const p = ports[i%ports.length]; appendOut(`${target}:${p} - ${Math.random()>0.5?'OPEN':'CLOSED'}`); i++; if(i>ports.length-1){clearInterval(id);appendTool('Port scan complete')}} ,400)
}

function spawnLogBurst(){
  for(let i=0;i<20;i++){ setTimeout(()=>{appendDebug(randomLogLine())}, i*80) }
}

function simulateAttackScenario(){
  spawnIncident()
  spawnIncident()
  appendDebug('Simulated attack wave detected')
  for(let i=0;i<4;i++){ setTimeout(()=>{simulateMetricsOnce();simulatePortScan('10.0.3.'+(10+i));}, i*500) }
}

function simulateSSH(target='srv-web-01'){
  appendOut(`ssh ${target}`)
  appendOut('Authenticating...')
  setTimeout(()=>{appendOut('password accepted');appendOut(`${target}$ ls -la /var/www`)},700)
  setTimeout(()=>{appendOut('-rw-r--r-- index.html');appendOut('-rw-r--r-- app.js')},1200)
}

function simulateTop(){
  appendOut('PID   CPU%   MEM%   NAME')
  for(let i=0;i<8;i++){ appendOut(`${1000+i}  ${rnd(0,99)}%    ${rnd(0,99)}%   process-${i}`) }
}

function simulateKill(pid){
  appendOut(`killing ${pid}...`)
  setTimeout(()=>{appendOut(`process ${pid} terminated`);appendTool(`Killed process ${pid}`)},600)
}

function showAscii(){
  const art = `
   ____  _____ __  ______  __
  / __ \\/ ___// / / / __ \\/ /__
 / / / /\\__ \\/ /_/ / /_/ / //_/
/_/ /_/____/ /____/\\____/\\__/
`
  appendOut('<pre class="ascii">'+art+'</pre>')
}

function showFiles(path='/var/www'){
  appendOut('Listing '+path)
  appendOut('drwxr-xr-x  4096 index.html')
  appendOut('-rw-r--r--  2048 app.js')
  appendOut('-rw-r--r--  1024 style.css')
}

function generateApiKey(){
  const key = [...Array(4)].map(()=>Math.random().toString(36).substring(2,10)).join('-')
  appendOut('NEW_KEY: '+key)
  appendTool('API Key generated')
}

function secretVault(){
  appendOut('vault: access denied (simulated)')
}

function calc(expression){
  try{
    const clean = expression.replace(/[^-()\d/*+. %]/g,'')
    const res = Function('"use strict";return ('+clean+')')()
    appendOut(expression + ' = ' + res)
  }catch(e){appendOut('calc: invalid expression')}
}

function fortune(){
  const f = ['You will spot a memory leak today.','Your next commit will be green.','Expect a surprise deploy.','Watch out for off-by-one errors.','Backup before lunch.']
  appendOut(f[rnd(0,f.length-1)])
}

function help(){
  appendOut('Available commands:')
  const cmds = Object.keys(COMMANDS).sort()
  appendOut(cmds.join(', '))
  appendOut('Type help <cmd> for details')
}

const COMMANDS = {
  help: {fn:(a)=>{ if(!a) return help(); if(COMMANDS[a]) appendOut(a+' - '+(COMMANDS[a].desc||'No description')); else appendOut('No such command')}, desc:'Show help'},
  hello: {fn:()=>appendOut('Hello Operator') , desc:'Greet the console'},
  clear: {fn:()=>{output.innerHTML=''; appendOut('Console cleared')}, desc:'Clear console'},
  time: {fn:()=>appendOut(new Date().toString()), desc:'Show time'},
  services: {fn:()=>services.forEach(s=>appendOut(`${s.name} ${s.status?'UP':'DOWN'} ${s.lat}ms`)), desc:'List services'},
  stats: {fn:()=>appendOut(`CPU Avg: ${document.getElementById('cpuAvg').textContent} RAM Avg: ${document.getElementById('ramAvg').textContent}`), desc:'Show summarized metrics'},
  echo: {fn:(a)=>appendOut(a||''), desc:'Echo text'},
  matrix: {fn:()=>{for(let i=0;i<10;i++) setTimeout(()=>appendOut(Array(80).fill(0).map(()=>Math.random()>0.7?'#':' ').join('')) , i*60)}, desc:'Matrix rain'},
  tail: {fn:()=>tailLogs(), desc:'Tail logs for 12s'},
  pcap: {fn:(a)=>togglePcap(), desc:'Start/stop packet capture'},
  deploy: {fn:()=>simulateDeploy(), desc:'Simulate deployment'},
  stress: {fn:(a)=>simulateStress(), desc:'Run stress test'},
  audit: {fn:()=>runAudit(), desc:'Run configuration audit'},
  portscan: {fn:(a)=>simulatePortScan(a||'127.0.0.1'), desc:'Port scan target'},
  spawn: {fn:()=>spawnIncident(), desc:'Spawn a single incident'},
  panic: {fn:()=>spawnPanic(), desc:'Trigger panic wave'},
  ssh: {fn:(a)=>simulateSSH(a||'srv-web-01'), desc:'Simulate ssh into host'},
  top: {fn:()=>simulateTop(), desc:'Show top-like process list'},
  kill: {fn:(a)=>simulateKill(a||'1001'), desc:'Kill process id'},
  files: {fn:(a)=>showFiles(a||'/var/www'), desc:'List files'},
  ascii: {fn:()=>showAscii(), desc:'Show ascii art'},
  genkey: {fn:()=>generateApiKey(), desc:'Generate API key'},
  vault: {fn:()=>secretVault(), desc:'Access secret vault (sim)'},
  calc: {fn:(a)=>calc(a||''), desc:'Calculate expression'},
  fortune: {fn:()=>fortune(), desc:'Get fortune'},
  debug: {fn:(a)=>appendDebug(a||'manually triggered debug'), desc:'Append debug log'},
  logburst: {fn:()=>spawnLogBurst(), desc:'Create log burst'},
  attack: {fn:()=>simulateAttackScenario(), desc:'Simulate attack wave'},
  helpme: {fn:()=>appendOut('Contact: ops@boxnburn.local'), desc:'Contact info'},
  banner: {fn:()=>showAscii(), desc:'Show banner'},
  news: {fn:()=>{const headlines=["New CVE detected","System patch applied","Suspicious login","Firewall updated","Backup completed","AI detected anomaly"]; const s=headlines[rnd(0,headlines.length-1)]; addNews(s); appendOut('News added: '+s)}, desc:'Push a news item'},
  whoami: {fn:()=>appendOut('Operator: ' + (localStorage.getItem('loggedInUser')||'unknown')), desc:'Who is logged in'},
  ping: {fn:()=>appendOut('Ping: '+Math.round(Math.random()*50+10)+' ms'), desc:'Ping test'},
  simulate: {fn:(a)=>{ if(!a) return appendOut('simulate <spike|ddos|outage|patch|backup-fail>'); if(a==='spike'){ appendOut('Simulating CPU spike'); for(let i=0;i<6;i++){ setTimeout(()=>{ const val = Math.min(100,(cpuChart.data.datasets[0].data.length?cpuChart.data.datasets[0].data[cpuChart.data.datasets[0].data.length-1]:15)+ rnd(20,45)); pushToChart(cpuChart,new Date().toLocaleTimeString(),val) }, i*700)} pushIncident('High CPU','Web cluster experienced spike','CRITICAL') } else if(a==='ddos'){ appendOut('Simulating DDoS'); COMMANDS['start']({fn:()=>{}}); pushIncident('DDoS Attack','Large volume of traffic', 'CRITICAL') } else if(a==='outage'){ appendOut('Simulating outage: mail down'); services.forEach(s=>{ if(s.svc==='SMTP') s.status=false }); renderServices(); pushIncident('Mail Service Down','SMTP returning 503','HIGH') } else if(a==='patch'){ appendOut('Simulating patch rollout'); addNews('Patch deployed to web cluster'); setTimeout(()=>{ appendOut('Patch verification ok'); addNews('Patch verification passed') },2200) } else if(a==='backup-fail'){ appendOut('Simulating backup failure'); pushIncident('Backup Failed','Storage quota exceeded','HIGH') } else appendOut('unknown simulate type') }, desc:'Simulate events'},
  start: {fn:(a)=>{ if(!a) return appendOut('start <cpu|ram|disk|threat|net|all>'); if(a==='cpu'){ if(window.__cpuInterval) return appendOut('cpu already running'); window.__cpuInterval=setInterval(()=>{ const last = cpuChart.data.datasets[0].data.length?cpuChart.data.datasets[0].data[cpuChart.data.datasets[0].data.length-1]:15; const next = Math.max(1, Math.min(100, last + rnd(-6,10))); pushToChart(cpuChart,new Date().toLocaleTimeString(),next); document.getElementById('cpuAvg').textContent = next+'%'; }, 1000); appendOut('cpu monitor started') } else if(a==='ram'){ if(window.__ramInterval) return appendOut('ram already running'); window.__ramInterval=setInterval(()=>{ const last = ramChart.data.datasets[0].data.length?ramChart.data.datasets[0].data[ramChart.data.datasets[0].data.length-1]:30; const next = Math.max(1, Math.min(100, last + rnd(-5,8))); pushToChart(ramChart,new Date().toLocaleTimeString(),next); document.getElementById('ramAvg').textContent = next+'%'; }, 1200); appendOut('ram monitor started') } else if(a==='disk'){ if(window.__diskInterval) return appendOut('disk already running'); window.__diskInterval=setInterval(()=>{ const last = diskChart.data.datasets[0].data.length?diskChart.data.datasets[0].data[diskChart.data.datasets[0].data.length-1]:32; const next = Math.max(1, Math.min(100, last + rnd(-4,6))); pushToChart(diskChart,new Date().toLocaleTimeString(),next); }, 1400); appendOut('disk monitor started') } else if(a==='threat'){ if(window.__threatInterval) return appendOut('threat already running'); window.__threatInterval=setInterval(()=>{ threatChart.data.datasets[0].data = threatChart.data.datasets[0].data.map(()=>rnd(0,100)); threatChart.update(); }, 900); appendOut('threat monitor started') } else if(a==='net'){ if(window.__netInterval) return appendOut('net already running'); window.__netInterval=setInterval(()=>{ const n = rnd(5,95); document.getElementById('netGauge').style.background = `conic-gradient(var(--accent) ${n}%, var(--glass) ${n}%)`; document.getElementById('netGaugeVal').textContent = n + '%'; }, 900); appendOut('net monitor started') } else if(a==='all'){ COMMANDS['start'].fn('cpu'); COMMANDS['start'].fn('ram'); COMMANDS['start'].fn('disk'); COMMANDS['start'].fn('threat'); COMMANDS['start'].fn('net'); appendOut('all monitors started') } else appendOut('unknown monitor') }, desc:'Start live monitors'},
  stop: {fn:(a)=>{ if(!a) return appendOut('stop <cpu|ram|disk|threat|net|all>'); if(a==='cpu' && window.__cpuInterval){ clearInterval(window.__cpuInterval); window.__cpuInterval=null; appendOut('cpu stopped') } else if(a==='ram' && window.__ramInterval){ clearInterval(window.__ramInterval); window.__ramInterval=null; appendOut('ram stopped') } else if(a==='disk' && window.__diskInterval){ clearInterval(window.__diskInterval); window.__diskInterval=null; appendOut('disk stopped') } else if(a==='threat' && window.__threatInterval){ clearInterval(window.__threatInterval); window.__threatInterval=null; appendOut('threat stopped') } else if(a==='net' && window.__netInterval){ clearInterval(window.__netInterval); window.__netInterval=null; appendOut('net stopped') } else if(a==='all'){ ['__cpuInterval','__ramInterval','__diskInterval','__threatInterval','__netInterval'].forEach(k=>{ if(window[k]){ clearInterval(window[k]); window[k]=null } }); appendOut('all stopped') } else appendOut('unknown stop target') }, desc:'Stop monitors'},
  scan: {fn:(a)=>simulatePortScan(a||'127.0.0.1'), desc:'Port scan target'},
  tail: {fn:(a)=>tailLogs(), desc:'Tail logs for seconds'},
  pcap: {fn:(a)=>togglePcap(), desc:'PCAP capture simulated'},
  deploy: {fn:()=>simulateDeploy(), desc:'Simulated deploy'},
  stress: {fn:(a)=>simulateStress(a), desc:'Simulated stress test'},
  audit: {fn:()=>runAudit(), desc:'Run config audit'},
  genkey: {fn:()=>generateApiKey(), desc:'Generate API key'},
  incident: {fn:(a)=>{ if(!a) return appendOut('incident add <title>|<message>|<level> | incident list | incident resolve'); const sub = a.split(' ')[0]; if(sub==='add'){ const payload = a.substring(4).split('|'); if(payload.length<3) return appendOut('format: incident add Title|Message|LEVEL'); pushIncident(payload[0].trim(),payload[1].trim(),payload[2].trim()); appendOut('incident added') } else if(sub==='list'){ if(incidents.length===0) appendOut('no incidents'); else incidents.forEach(i=>appendOut(i.title+' ['+i.level+'] - '+new Date(i.ts).toLocaleString())) } else if(sub==='resolve'){ const popped = incidents.shift(); if(popped){ appendOut('resolved: '+popped.title); appendDebug('Resolved: '+popped.title) } else appendOut('no incidents to resolve') } else appendOut('unknown incident subcommand') }, desc:'Manage incidents'},
  download: {fn:(a)=>{ if(a==='logs' || a==='log'){ const content = (function(){ let c=''; const nodes = document.querySelectorAll('#debugLog div'); nodes.forEach(n=> c += n.textContent + '\n'); return c })(); const blob = new Blob([content],{type:'text/plain'}); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href=url; link.download='tool-log.txt'; link.click(); URL.revokeObjectURL(url); appendOut('logs downloaded') } else appendOut('usage: download logs') }, desc:'Download logs'},
  export: {fn:(a)=>{ if(a==='csv'){ const rows = [['ts','msg'], ...Array.from(document.querySelectorAll('#debugLog div')).map(n=> [new Date().toISOString(), n.textContent])]; const csv = rows.map(r=> r.map(c=> `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href=url; link.download='tool-log.csv'; link.click(); URL.revokeObjectURL(url); appendOut('csv exported') } else appendOut('usage: export csv') }, desc:'Export logs'},
  matrix: {fn:()=>{ appendOut('Matrix mode'); for(let i=0;i<20;i++) setTimeout(()=> appendOut(Array(80).fill(0).map(()=>Math.random()>0.86?String.fromCharCode(rnd(33,126)):' ').join(''), '#0f0'), i*60) }, desc:'Matrix rain'},
  hack: {fn:()=>{ appendOut('Simulated hack'); ['Accessing nodes','Bypassing firewall','Opening tunnel','Root shell'].forEach((t,i)=> setTimeout(()=> appendOut(t,'#ff5c7c'), i*700)); setTimeout(()=> pushIncident('Simulated intrusion','Operator triggered hack demo','MEDIUM'), 3000) }, desc:'Playful hack demo'},
  games: {fn:()=>appendOut('Mini-games: snake, tetris'), desc:'List games'},
  snake: {fn:()=>{ appendOut('Starting snake demo'); const width=28,height=12; let snake=[{x:6,y:6},{x:5,y:6},{x:4,y:6}]; let dir={x:1,y:0}; let food={x:rnd(2,width-3),y:rnd(2,height-3)}; const render=()=>{ let out=''; for(let y=0;y<height;y++){ for(let x=0;x<width;x++){ if(x===0||y===0||x===width-1||y===height-1) out+='#'; else if(snake.some(p=>p.x===x&&p.y===y)) out+='O'; else if(food.x===x&&food.y===y) out+='*'; else out+=' '; } out+='\n' } appendOut('<pre class="ascii">'+out+'</pre>') }; let steps=0; const id = setInterval(()=>{ const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y}; if(head.x<=0||head.x>=width-1||head.y<=0||head.y>=height-1){ clearInterval(id); appendOut('Snake ended'); return } snake.unshift(head); if(head.x===food.x&&head.y===food.y){ food={x:rnd(2,width-3),y:rnd(2,height-3)} } else snake.pop(); render(); steps++; if(steps>30){ clearInterval(id); appendOut('Snake demo auto-stopped') } }, 380) }, desc:'Snake demo'},
  tetris: {fn:()=>{ appendOut('Tetris demo'); const blocks=['[]','==','##','<>']; let drop=0; const id=setInterval(()=>{ appendOut('Row '+(++drop)+': '+blocks[rnd(0,blocks.length-1)].repeat(rnd(4,8))); if(drop>12){ clearInterval(id); appendOut('Tetris demo ended') } }, 420) }, desc:'Tetris demo'},
  calc: {fn:(a)=>{ try{ const clean = a.replace(/[^-()\d/*+. %]/g,''); const res = Function('"use strict";return ('+clean+')')(); appendOut(a + ' = ' + res) } catch(e){ appendOut('calc: invalid expression') } }, desc:'Calculator'},
  fortune: {fn:()=>{ const f=['You will find a mem-leak.','Your next commit will be green.','Expect a surprise deploy.','Watch out for off-by-one errors.','Backup before lunch.']; appendOut(f[rnd(0,f.length-1)]) }, desc:'Fortune'},
  reboot: {fn:()=>{ appendOut('Rebooting (simulated)'); appendOut('Stopping services...'); setTimeout(()=> appendOut('Booting kernel...'), 1200); setTimeout(()=> appendOut('Services online. Boot complete.'), 3000) }, desc:'Reboot'},
  shutdown: {fn:()=>{ appendOut('Shutdown (simulated). Reload page to continue.'); appendOut('System halted') }, desc:'Shutdown'}
}

function execute(line){
  if(!line || !line.trim()) return
  appendOut('> '+line,'#9fb0bf')
  const parts = line.trim().split(' ')
  const cmd = parts[0]
  const arg = parts.slice(1).join(' ')
  if(COMMANDS[cmd]){ try{ COMMANDS[cmd].fn(arg) } catch(e){ appendOut('Command error: '+e.message) } } else appendOut('Unknown command: '+cmd)
  const nowLog = document.createElement('div'); nowLog.textContent = new Date().toISOString() + ' CMD ' + line; debugLog.prepend(nowLog); if(debugLog.children.length>500) debugLog.removeChild(debugLog.lastChild)
}

document.getElementById('runBtn').addEventListener('click', ()=>{ execute(cmdInput.value); cmdInput.value=''; cmdInput.focus() })
cmdInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ document.getElementById('runBtn').click() } })

document.getElementById('clearIncidents').addEventListener('click', ()=>{ incidents.length=0; renderIncidents(); appendTool('Cleared incidents') })
document.getElementById('downloadLog').addEventListener('click', ()=> downloadLog())

function appendOutStart(){
  appendOut('Welcome to Box N Burn Command Center (Sim)')
  appendOut('Type "help" to get started. Example: start cpu, simulate spike, portscan 10.0.1.5, snake')
  appendDebug('Session started')
  appendTool('Simulator ready')
}
appendOutStart()
simulateMetricsOnce()
renderServices()

</script>
</body>
</html>
