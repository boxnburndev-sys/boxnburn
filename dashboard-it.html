<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard-Sys</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#0e1621;color:#f5f5f5}
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:14px 24px;background:#0a1a2f;box-shadow:0 4px 10px rgba(0,0,0,0.4)}
    .brand{font-size:1.4rem;font-weight:bold;color:#0f93ff}
    .nav-right{display:flex;align-items:center;gap:20px}
    .status-live{color:#4caf50;font-weight:bold}
    .profile span{color:#0f93ff;font-weight:bold}
    .profile a{color:#f5f5f5;text-decoration:none;margin-left:8px}
    .profile a:hover{color:#0f93ff}
    .content{padding:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;margin-bottom:20px}
    .card{background:#162230;border-radius:14px;padding:20px;box-shadow:0 6px 16px rgba(0,0,0,0.4);transition:transform 0.2s}
    .card:hover{transform:translateY(-5px)}
    .stat-title{font-size:0.9rem;opacity:0.8}
    .stat-value{font-size:2rem;font-weight:bold;margin-top:8px;color:#0f93ff}
    .status-up{color:#4caf50;font-weight:bold}
    .status-down{color:#f44336;font-weight:bold}
    canvas{max-height:220px}
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="brand">⚡ Dashboard-Sys</div>
    <div class="nav-right">
      <div class="status-live">● LIVE</div>
      <div class="profile">
        Welcome, <span id="username"></span> | 
        <a href="index.html" onclick="logout()">Home</a> | 
        <a href="ITdash.html" onclick="logout()">Logout</a>
      </div>
    </div>
  </nav>

  <div class="content">
    <!-- Top stats -->
    <div class="grid">
      <div class="card">
        <div class="stat-title">Active Servers</div>
        <div class="stat-value" id="serverCount">0</div>
      </div>
      <div class="card">
        <div class="stat-title">Avg CPU Load</div>
        <div class="stat-value" id="cpuAvg">0%</div>
      </div>
      <div class="card">
        <div class="stat-title">Avg RAM Usage</div>
        <div class="stat-value" id="ramAvg">0%</div>
      </div>
      <div class="card">
        <div class="stat-title">Ping (ms)</div>
        <div class="stat-value" id="pingStat">-</div>
      </div>
    </div>

    <!-- Charts -->
    <div class="grid">
      <div class="card"><h3>CPU Usage</h3><canvas id="cpuChart"></canvas></div>
      <div class="card"><h3>RAM Usage</h3><canvas id="ramChart"></canvas></div>
      <div class="card"><h3>Disk Usage</h3><canvas id="diskChart"></canvas></div>
    </div>

    <!-- Services -->
    <div class="card">
      <h3>Service Status</h3>
      <table style="width:100%;margin-top:10px;border-collapse:collapse">
        <thead><tr><th style="text-align:left;padding:6px">Service</th><th style="text-align:left;padding:6px">Status</th></tr></thead>
        <tbody id="serviceTable"></tbody>
      </table>
    </div>
  </div>

<script>
  // ===== LOGIN PROTECTION =====
  if(localStorage.getItem("loggedIn")!=="true"){
    window.location.href="login.html";
  }
  document.getElementById("username").textContent=localStorage.getItem("username")||"User";

  function logout(){
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("username");
  }

  // ===== SYSTEM DATA SIMULATION =====
  const servers = [
    {name:"Web Server 1", cpu:0, ram:0, disk:0},
    {name:"DB Server", cpu:0, ram:0, disk:0},
    {name:"Backup Node", cpu:0, ram:0, disk:0},
    {name:"Proxy Server", cpu:0, ram:0, disk:0}
  ];

  // Charts
  const labels=[];
  const cpuData=[]; const ramData=[]; const diskData=[];

  const cpuChart=new Chart(document.getElementById("cpuChart"),{
    type:'line',data:{labels,datasets:[{label:'CPU %',data:cpuData,borderColor:'#0f93ff',tension:0.3}]},
    options:{scales:{y:{min:0,max:100}}}
  });
  const ramChart=new Chart(document.getElementById("ramChart"),{
    type:'line',data:{labels,datasets:[{label:'RAM %',data:ramData,borderColor:'#4caf50',tension:0.3}]},
    options:{scales:{y:{min:0,max:100}}}
  });
  const diskChart=new Chart(document.getElementById("diskChart"),{
    type:'line',data:{labels,datasets:[{label:'Disk %',data:diskData,borderColor:'#f44336',tension:0.3}]},
    options:{scales:{y:{min:0,max:100}}}
  });

  function updateSystemStats(){
    let cpuSum=0, ramSum=0;
    servers.forEach(s=>{
      s.cpu=(Math.random()*70+10).toFixed(1);
      s.ram=(Math.random()*60+20).toFixed(1);
      s.disk=(Math.random()*50+40).toFixed(1);
      cpuSum+=parseFloat(s.cpu);
      ramSum+=parseFloat(s.ram);
    });

    document.getElementById("serverCount").textContent=servers.length;
    document.getElementById("cpuAvg").textContent=(cpuSum/servers.length).toFixed(1)+"%";
    document.getElementById("ramAvg").textContent=(ramSum/servers.length).toFixed(1)+"%";

    const now=new Date().toLocaleTimeString();
    labels.push(now);
    cpuData.push((cpuSum/servers.length).toFixed(1));
    ramData.push((ramSum/servers.length).toFixed(1));
    diskData.push(servers[0].disk);

    if(labels.length>15){labels.shift();cpuData.shift();ramData.shift();diskData.shift();}
    cpuChart.update();ramChart.update();diskChart.update();
  }

  // ===== PING TEST =====
  async function runPing(){
    const start=performance.now();
    try{
      await fetch("https://www.google.com",{mode:"no-cors"});
      const end=performance.now();
      document.getElementById("pingStat").textContent=Math.round(end-start);
    }catch{
      document.getElementById("pingStat").textContent="Timeout";
    }
  }

  // ===== SERVICE STATUS =====
  const services=[
    {name:"Website",url:"https://example.com"},
    {name:"API",url:"https://jsonplaceholder.typicode.com/posts"},
    {name:"Intranet",url:"https://httpstat.us/200"},
    {name:"Mail Server",url:"https://httpstat.us/503"}
  ];

  async function checkServices(){
    const table=document.getElementById("serviceTable");
    table.innerHTML="";
    for(const s of services){
      let status;
      try{
        const res=await fetch(s.url);
        status=res.ok?'<span class="status-up">UP</span>':'<span class="status-down">DOWN</span>';
      }catch{status='<span class="status-down">DOWN</span>';}
      table.innerHTML+=`<tr><td style="padding:6px">${s.name}</td><td style="padding:6px">${status}</td></tr>`;
    }
  }

  // ===== INIT LOOP =====
  updateSystemStats();
  runPing();
  checkServices();
  setInterval(updateSystemStats,5000);
  setInterval(runPing,10000);
  setInterval(checkServices,30000);
</script>
</body>
</html>
